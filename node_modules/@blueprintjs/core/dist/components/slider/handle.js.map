{"version":3,"sources":["../src/components/slider/handle.tsx"],"names":[],"mappings":"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","file":"handle.js","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n * Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy\n * of the license at https://github.com/palantir/blueprint/blob/master/LICENSE\n * and https://github.com/palantir/blueprint/blob/master/PATENTS\n */\n\nimport * as classNames from \"classnames\";\nimport * as PureRender from \"pure-render-decorator\";\nimport * as React from \"react\";\n\nimport { AbstractComponent } from \"../../common/abstractComponent\";\nimport * as Classes from \"../../common/classes\";\nimport * as Keys from \"../../common/keys\";\nimport { IProps } from \"../../common/props\";\nimport { clamp, safeInvoke } from \"../../common/utils\";\n\n/**\n * N.B. some properties need to be optional for spread in slider.tsx to work\n */\nexport interface IHandleProps extends IProps {\n    disabled?: boolean;\n    label: React.ReactChild;\n    max?: number;\n    min?: number;\n    onChange?: (newValue: number) => void;\n    onRelease?: (newValue: number) => void;\n    stepSize?: number;\n    tickSize?: number;\n    value?: number;\n}\n\nexport interface IHandleState {\n    /** whether slider handle is currently being dragged */\n    isMoving?: boolean;\n}\n\n// props that require number values, for validation\nconst NUMBER_PROPS = [\"max\", \"min\", \"stepSize\", \"tickSize\", \"value\"];\n\n@PureRender\nexport class Handle extends AbstractComponent<IHandleProps, IHandleState> {\n    public static displayName = \"Blueprint.SliderHandle\";\n    public state = {\n        isMoving: false,\n    };\n\n    private handleElement: HTMLElement;\n    private refHandlers = {\n        handle: (el: HTMLSpanElement) => (this.handleElement = el),\n    };\n\n    public render() {\n        const { className, disabled, label, min, tickSize, value } = this.props;\n        const { isMoving } = this.state;\n        // getBoundingClientRect().height includes border size as opposed to clientHeight\n        const handleSize = this.handleElement == null ? 0 : this.handleElement.getBoundingClientRect().height;\n        return (\n            <span\n                className={classNames(Classes.SLIDER_HANDLE, { [Classes.ACTIVE]: isMoving }, className)}\n                onKeyDown={disabled ? null : this.handleKeyDown}\n                onKeyUp={disabled ? null : this.handleKeyUp}\n                onMouseDown={disabled ? null : this.beginHandleMovement}\n                onTouchStart={disabled ? null : this.beginHandleTouchMovement}\n                ref={this.refHandlers.handle}\n                style={{ left: Math.round((value - min) * tickSize - handleSize / 2) }}\n                tabIndex={0}\n            >\n                {label == null ? null : <span className={Classes.SLIDER_LABEL}>{label}</span>}\n            </span>\n        );\n    }\n\n    public componentWillUnmount() {\n        this.removeDocumentEventListeners();\n    }\n\n    /** Convert client pixel to value between min and max. */\n    public clientToValue(clientPixel: number) {\n        const { stepSize, tickSize, value } = this.props;\n        if (this.handleElement == null) {\n            return value;\n        }\n        const handleRect = this.handleElement.getBoundingClientRect();\n        const handleCenterPixel = handleRect.left + handleRect.width / 2;\n        const pixelDelta = clientPixel - handleCenterPixel;\n        // convert pixels to range value in increments of `stepSize`\n        const valueDelta = Math.round(pixelDelta / (tickSize * stepSize)) * stepSize;\n        return value + valueDelta;\n    }\n\n    public touchEventClientX(event: TouchEvent | React.TouchEvent<HTMLElement>) {\n        return event.changedTouches[0].clientX;\n    }\n\n    public beginHandleMovement = (event: MouseEvent | React.MouseEvent<HTMLElement>) => {\n        document.addEventListener(\"mousemove\", this.handleHandleMovement);\n        document.addEventListener(\"mouseup\", this.endHandleMovement);\n        this.setState({ isMoving: true });\n        this.changeValue(this.clientToValue(event.clientX));\n    };\n\n    public beginHandleTouchMovement = (event: TouchEvent | React.TouchEvent<HTMLElement>) => {\n        document.addEventListener(\"touchmove\", this.handleHandleTouchMovement);\n        document.addEventListener(\"touchend\", this.endHandleTouchMovement);\n        document.addEventListener(\"touchcancel\", this.endHandleTouchMovement);\n        this.setState({ isMoving: true });\n        this.changeValue(this.clientToValue(this.touchEventClientX(event)));\n    };\n\n    protected validateProps(props: IHandleProps) {\n        for (const prop of NUMBER_PROPS) {\n            if (typeof (props as any)[prop] !== \"number\") {\n                throw new Error(`[Blueprint] <Handle> requires number value for ${prop} prop`);\n            }\n        }\n    }\n\n    private endHandleMovement = (event: MouseEvent) => {\n        this.handleMoveEndedAt(event.clientX);\n    };\n\n    private endHandleTouchMovement = (event: TouchEvent) => {\n        this.handleMoveEndedAt(this.touchEventClientX(event));\n    };\n\n    private handleMoveEndedAt = (clientPixel: number) => {\n        this.removeDocumentEventListeners();\n        this.setState({ isMoving: false });\n        // not using changeValue because we want to invoke the handler regardless of current prop value\n        const { onRelease } = this.props;\n        const finalValue = this.clamp(this.clientToValue(clientPixel));\n        safeInvoke(onRelease, finalValue);\n    };\n\n    private handleHandleMovement = (event: MouseEvent) => {\n        this.handleMovedTo(event.clientX);\n    };\n\n    private handleHandleTouchMovement = (event: TouchEvent) => {\n        this.handleMovedTo(this.touchEventClientX(event));\n    };\n\n    private handleMovedTo = (clientPixel: number) => {\n        if (this.state.isMoving && !this.props.disabled) {\n            this.changeValue(this.clientToValue(clientPixel));\n        }\n    };\n\n    private handleKeyDown = (event: React.KeyboardEvent<HTMLSpanElement>) => {\n        const { stepSize, value } = this.props;\n        const { which } = event;\n        if (which === Keys.ARROW_DOWN || which === Keys.ARROW_LEFT) {\n            this.changeValue(value - stepSize);\n            // this key event has been handled! prevent browser scroll on up/down\n            event.preventDefault();\n        } else if (which === Keys.ARROW_UP || which === Keys.ARROW_RIGHT) {\n            this.changeValue(value + stepSize);\n            event.preventDefault();\n        }\n    };\n\n    private handleKeyUp = (event: React.KeyboardEvent<HTMLSpanElement>) => {\n        if ([Keys.ARROW_UP, Keys.ARROW_DOWN, Keys.ARROW_LEFT, Keys.ARROW_RIGHT].indexOf(event.which) >= 0) {\n            safeInvoke(this.props.onRelease, this.props.value);\n        }\n    };\n\n    /** Clamp value and invoke callback if it differs from current value */\n    private changeValue(newValue: number, callback = this.props.onChange) {\n        newValue = this.clamp(newValue);\n        if (!isNaN(newValue) && this.props.value !== newValue) {\n            safeInvoke(callback, newValue);\n        }\n    }\n\n    /** Clamp value between min and max props */\n    private clamp(value: number) {\n        return clamp(value, this.props.min, this.props.max);\n    }\n\n    private removeDocumentEventListeners() {\n        document.removeEventListener(\"mousemove\", this.handleHandleMovement);\n        document.removeEventListener(\"mouseup\", this.endHandleMovement);\n        document.removeEventListener(\"touchmove\", this.handleHandleTouchMovement);\n        document.removeEventListener(\"touchend\", this.endHandleTouchMovement);\n        document.removeEventListener(\"touchcancel\", this.endHandleTouchMovement);\n    }\n}\n"]}